parameters:
  doctrine.connection.name: 'doctrine'
  doctrine.database.name: 'doctrine'
  doctrine.entity.map.file: 'entitymap'
  doctrine.entity.map.extension: '.orm.yml'

services:
  doctrine.entity.manager:
    class: Doctrine\ORM\EntityManager
    factory: ['@doctrine.entity.manager.factory', 'create']
    arguments:
      - '@database.mvcc'
      - '@doctrine.config'
      - '@doctrine.event.manager'
  doctrine.config:
    class: Doctrine\ORM\Configuration
    factory: ['@doctrine.config.factory', getConfiguration]
    arguments:
      - '@doctrine.cache'
      - '%app.env%'
      - '%app.dir%/%app.config.dir%'
      - '%doctrine.entity.map.file%'
      - '%doctrine.entity.map.extension%'
  doctrine.config.factory:
    class: Vain\Doctrine\Factory\DoctrineConfigurationFactory
  doctrine.event.manager:
    class: Doctrine\Common\EventManager
  connection.factory.doctrine:
    class: Vain\Doctrine\Connection\Factory\DoctrineConnectionFactory
    arguments: ['pdo.doctrine']
    tags:
      - {name: connection.factory}
  doctrine.connection.pdo:
    class: PDOConnection
    factory: ['@connection.storage', getConnection]
    arguments:
      - '%doctrine.connection.name%'
  database.factory.doctrine:
    class: Vain\Doctrine\Database\Factory\DoctrineDatabaseFactory
    arguments: ['@doctrine.config', '@doctrine.event.manager', '@doctrine.connection.pdo', '@database.generator.factory', '%doctrine.database.name%']
    tags:
      - {name: database.factory}
  doctrine.cache.redis:
    class: Vain\Doctrine\Cache\Redis\DoctrineRedisCache
    arguments: ['@app.cache.redis']
  doctrine.entity.manager.factory:
    class: Vain\Doctrine\Factory\DoctrineEntityManagerFactory
  doctrine.entity.operation.factory:
    class: Vain\Doctrine\Entity\Operation\Factory\DoctrineEntityOperationFactory
    arguments: ['@doctrine.entity.manager']
  doctrine.operation.collection.factory:
    class: Vain\Doctrine\Operation\Collection\Factory\Decorator\DoctrineCollectionFactoryDecorator
    decorates: operation.collection.factory
    arguments: ['@doctrine.operation.collection.factory.inner', '@doctrine.entity.manager']